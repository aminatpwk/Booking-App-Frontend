<main class="results-page-container">

  <section class="results-header">
    <h1>Apartments in {{ location || 'Search Area' }}</h1>
    @if (checkInDate && checkOutDate){
      <p>Viewing {{ totalCount }} results available from {{ checkInDate }} to {{ checkOutDate }}</p>
    }
    @if (!checkInDate || !checkOutDate){
      <p>{{ totalCount }} apartments found</p>
    }
    <div class="map-view-toggle">
      <button>Show on map</button>
    </div>
  </section>

  <div class="content-wrapper">

    <section class="results-list-section">
      <div class="sort-toolbar">
        <span class="count">{{ totalCount }} apartments found</span>
        <label for="sort-by">Sort By:</label>
        <select id="sort-by" [(ngModel)]="sortBy" (change) = "onSortChange()">
          <option value="priceAsc">Price (Lowest first)</option>
          <option value="priceDesc">Price (Highest first)</option>
          <option value="ratingDesc">Rating (Highest first)</option>
          <option value="nameAsc">Name (A-Z)</option>
          <option value="nameDesc">Name (Z-A)</option>
        </select>
      </div>

      @if (isLoading){
        <div class = "loading-state">
          <p>Loading apartments...</p>
          <div class="skeleton-list">
            @for (item of skeletonItems; track item.id) {
              <div class="skeleton-card">
                <div class="skeleton-image"></div>
                <div class="skeleton-details">
                  <div class="skeleton-line short"></div>
                  <div class="skeleton-line medium"></div>
                  <div class="skeleton-line full"></div>
                  <div class="skeleton-line short"></div>
                </div>
                <div class="skeleton-price">
                  <div class="skeleton-line short"></div>
                </div>
              </div>
            }
          </div>
        </div>
      }

      @if(errorMessage && !isLoading){
        <div class="error-state">
          <p>{{ errorMessage }}</p>
          <button type="button" (click)="loadApartments()">Retry</button>
        </div>
      }
      <div class="apartment-card-list">
        @for (apartment of apartments; track apartment.id) {
          <div class="apartment-card">

            <div class="image-placeholder">
              <img [src]="apartment.photos" alt="{{ apartment.name }}" class="apartment-image">
            </div>

            <div class="details">
              <h3 class="apartment-name">{{ apartment.name }}</h3>
              <p class="type-location-line">
                **{{ apartment.type }}** in {{ apartment.city }}, {{ apartment.country }}
              </p>

              <div class="key-features">
                <span>ğŸ›Œ {{ apartment.bedrooms }} beds</span>
                <span>ğŸ› {{ apartment.bathrooms }} baths</span>
                <span>ğŸ‘¥ Max {{ apartment.maxGuests }} guests</span>
              </div>

              @if (apartment.amenities && apartment.amenities.length > 0) {
                <p class="amenities-snippet">
                  Includes: {{getAmenitiesPreview(apartment.amenities)}}
                </p>
              }

              @if (!apartment.isAvailable) {
                <span class="status-badge unavailable">Currently Unavailable</span>
              } @else if (!apartment.isActive) {
                <span class="status-badge inactive">Inactive Listing</span>
              }

            </div>

            <div class="price-action">
              <div class="price-details">
                <span class="price">${{ apartment.price }}</span>
                <span class="price-per-night">per night</span>
                <span class="cleaning-fee">+$ {{ apartment.cleaningFee }} cleaning fee</span>
              </div>

              <button class="view-details-btn" [routerLink]="['/apartment', apartment.id]">View Details</button>
            </div>

          </div>
        }
      </div>

      @if (totalPages > 1 && !isLoading){
        <div class="pagination-controls">
          <button (click)="previousPage()" [disabled]="currentPage === 1">Previous</button>
          <span>Page {{ currentPage }} of {{ totalPages }}</span>
          <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
        </div>
      }
    </section>
  </div>
</main>
